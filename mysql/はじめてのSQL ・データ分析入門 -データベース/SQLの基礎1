

/* データベースの選択 */ 
use mydb;
/* ユーザー一覧の取得 */ 
select * from users;
/*ファイル名、フォルダ名を調整*/
select * from products;

/*コメントサンプル*/
-- select * from users;
/* select * from users;
select * from products */

/*列を指定してデータを取得する select*/
select id, last_name from users;

/* 列を指定してデータを取得する*/
select name, price from products;
select name, price from products;
select name as 名前, price as 価格 from products;
select name 名前, price 価格 from products;

/*列に別名をつける*/

select name, price from products;
select name as 名前, price as 価格 from products;
select name 名前, price 価格 from products;

/*列の値に対して演算を行う*/
select
    name as 名前,
    price as 価格,
    price * 1.08 as 税込価格
from
    products;

/*条件を指定してデータを取得する where*/
select name, price from products where price >= 9800;

/*比較演算子の種類*/
-- 1) products テーブルから全件取得
select * from products;
-- 2) idが1の行を取得
select * from products where id = 1;
-- 3) 名前が「商品0003」の行を取得
select * from products where name = '商品0003';
-- 4) priceが1000より大きい行を取得
select * from products where price > 1000;
-- 5) price が1000より小さい行を取得
select * from products where price < 1000;
-- 6) priceが100でない行を取得
select * from products where price <> 100;
-- 7) 次のようにもかけます。
select * from products where price != 100;
-- 8) idが1か2か3の行を取得
select * from products where id in(1, 2, 3);
-- 9)idが1か2か3ではない行を取得
select * from products where id not in(1, 2, 3);
-- 10)priceがnullではない行を取得
select * from products where price is not null;
-- 11)priceがnullの行を取得
select * from products where price is null;
-- 12)priceが1000から1900の行を取得
select * from products where price between 1000 and 1900;
-- 13)これは次のようandを使っても書ける。andは、論理積。条件AもBも成り立つ時にtrue（真）。
select * from products where price >= 1000 and price <= 1900;
-- 14)or （論理和）も使える。条件Aか条件Bが一つ以上成り立つ場合にtrue
-- 価格が1000円又は2000円の行を取得
select * from products where price = 1000 or price = 2000;

/*パターンマッチングによる絞込 like*/
select * from users where last_name like '中%';
select * from users where last_name like '%中%';
select * from users where first_name like '%子';
select * from users where first_name like '__子';

/*取得件数を制限する limit*/
select * from products limit 10;
select * from products limit 0, 10;
select * from products limit 10, 10;

/*演習回答：取得件数を制限する limit句*/
select id, last_name, gender from users where gender = 1 limit 10;

/*合計値を求める sum集約関数*/
-- select * from orders;

select
    sum(amount)
from
    orders
where
    order_time >= '2017-01-01 00:00:00'
    and order_time < '2017-02-01 00:00:00';

/*平均値を求める avg集約関数*/
-- select * from products;
select avg(price) from products;

/*最小値を求める min集約関数*/
select min(price) from products;

/*最大値を求める max集約関数*/
select max(price) from products;

/*対象行の行数を数える count集約関数*/
-- select * from users; 
-- select count(*) from users;
select count(*) from users where gender = 2;

/*月間ユニークユーザー数を求める*/
-- select * from access_logs;
select 
    count(distinct user_id)
from
    access_logs
where
    request_month = '2017-01-01';

/*データをグループ化 group by*/
select
    prefecture_id,
    count(*)
from
    users
group by
    prefecture_id;
### 応用 : 期間ごとに集計する 

select
    request_month,
    count(distinct user_id)
from 
    access_logs
where
    request_month >= '2017-01-01'
    and request_month < '2018-01-01'
group by
    request_month;

/*集計をさらに絞り込む having*/
select
    request_month,
    count(distinct user_id)
from 
    access_logs
where
    request_month >= '2017-01-01'
    and request_month < '2018-01-01'
group by
    request_month
having
    count(distinct user_id) >= 630;

/*演習：データの集約*/
-- select * from access_logs; 

select
    request_month,
    count(*)
from
    access_logs
where
    request_month >= '2017-01-01'
    and request_month < '2017-07-01'
group by 
    request_month
having
    count(*) >= 1000;

/*並び替え order by*/
-- select * from products order by price desc;
-- select * from products order by price asc;
select * from products order by price;

/*複数の並び替え条件を指定する*/
select * from products order by price desc, id asc;
select * from products order by price desc, id;

/*データの並び替え*/
-- 演習
-- ユーザー一覧を、出力。
-- 生年月日が古いに並べる。
-- 生年月日が一緒の場合は、都道府県ID順(昇順)に並べる。

-- select * from users order by birthday asc, prefecture_id asc;
select * from users order by birthday, prefecture_id;

/*いろいろな算術演算子*/
/* 足し算 */
select 10 + 3;

/* 引き算 */
select 10 - 3;

/* 掛け算 */
select 10 * 3;

/* 割り算 */
select 10 / 3;

/* 余り */
select 10 % 3;

/*nullを含む演算*/
/* 足し算 */
select 10 + null;

/* 引き算 */
select 10 - null;

/* 掛け算 */
select 10 * null;

/* 割り算 */
select 10 / null;

/* 余り */
select 10 % null;]

/*絶対値の取得 abs*/

/*四捨五入 round*/
/* 商品価格一覧を作成する時に、税込み価格を出力してほしい。
ただし、小数第1位で四捨五入して出力 */
select id, name, price * 1.08 from products;

select id, name, round(price * 1.08, 0) from products;

select round(10.555, 0);

select round(10.555, 1);

select round(10.555, 2);










